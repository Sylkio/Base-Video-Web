@page
@model VideoWebapp.Pages.WatchVideoModel

<h1>Watch Videos</h1>

<!-- Video Upload Form -->
<form method="post" action="/api/Videos/Upload" enctype="multipart/form-data">
    <div>
        <label for="file">Select Video File:</label>
        <input type="file" id="file" name="File" required />
    </div>
    <div>
        <label for="videoTitle">Video Title:</label>
        <input type="text" id="videoTitle" name="VideoTitle" required />
    </div>
    <div>
        <label for="videoDescription">Video Description:</label>
        <textarea id="videoDescription" name="VideoDescription" required></textarea>
    </div>
    <button type="submit">Upload Video</button>
</form>

<!-- JavaScript for Form Submission -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.querySelector('form');
        form.onsubmit = async function(event) {
            event.preventDefault();
            const formData = new FormData(form);
            try {
                alert('Uploading video, please wait...');
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData
                });
                if (response.ok) {
                    alert('Video uploaded successfully!');
                    window.location.reload(); // Reload the page to show the new video
                } else {
                    alert('Failed to upload video. Please try again.');
                }
            } catch (error) {
                alert('An error occurred during upload.');
            }
        };
    });
</script>

<!-- Video Display Section -->
<a href="/">GO BACK</a>
@if (Model.Videos != null && Model.Videos.Any())
{
    <div class="videos-container">
        @foreach (var video in Model.Videos)
        {
            <div class="video-item">
                <h3>@video.VideoTitle</h3>
                <video width="640" height="360" controls>
                    <source src="@video.VideoUrl" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        }
    </div>
}
else
{
    <p>No videos available.</p>
}
